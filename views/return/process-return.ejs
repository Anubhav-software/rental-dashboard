<div class="card h-100 p-0 radius-12" id="return-process-root" data-base-path="<%= typeof basePath !== 'undefined' ? basePath : '' %>" data-rental-id="<%= typeof rentalId !== 'undefined' ? rentalId : '' %>">
    <div class="card-body p-24">
        <p id="return-process-loading" class="text-center text-secondary-light py-24">Loading rental…</p>
        <div id="return-process-error" class="d-none text-center text-danger py-24"></div>
        <div id="return-process-form-wrap" class="d-none row justify-content-center">
            <div class="col-xxl-10 col-xl-11 col-lg-12">
                <!-- Rental summary (filled by JS) -->
                <div class="card border radius-16 overflow-hidden mb-24 bg-neutral-50 border-neutral-200">
                    <div class="card-body py-20 px-24">
                        <div class="row align-items-center">
                            <div class="col">
                                <h6 class="fw-semibold text-primary-light mb-2" id="return-summary-contract">—</h6>
                                <p class="text-sm text-secondary-light mb-0" id="return-summary-customer-vehicle">—</p>
                                <p class="text-sm text-secondary-light mb-0 mt-2" id="return-summary-expected">—</p>
                                <p class="text-sm text-secondary-light mb-0 mt-1" id="return-summary-advance-deposit">—</p>
                            </div>
                            <div class="col-auto">
                                <a href="#" id="return-process-back" class="btn btn-outline-secondary btn-sm radius-8 d-flex align-items-center gap-2">
                                    <iconify-icon icon="mdi:arrow-left"></iconify-icon> Back
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <form id="return-form">
                    <div id="return-form-error" class="alert alert-danger radius-12 mb-24 d-none"></div>

                    <!-- Actual return date & time -->
                    <div class="card border radius-12 overflow-hidden mb-24">
                        <div class="card-header bg-neutral-50 border-bottom py-14 px-20">
                            <h6 class="text-sm fw-semibold text-primary-light mb-0 d-flex align-items-center gap-2">
                                <iconify-icon icon="solar:calendar-outline" class="text-primary-600"></iconify-icon>
                                Actual return date & time
                            </h6>
                        </div>
                        <div class="card-body p-20">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label text-sm fw-medium text-primary-light">Return date <span class="text-danger">*</span></label>
                                    <input type="date" name="actual_return_date" id="actualReturnDate" class="form-control h-56-px bg-neutral-50 radius-12" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label text-sm fw-medium text-primary-light">Return time <span class="text-danger">*</span></label>
                                    <input type="time" name="actual_return_time" id="actualReturnTime" class="form-control h-56-px bg-neutral-50 radius-12" value="10:00" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional charges -->
                    <div class="card border radius-12 overflow-hidden mb-24">
                        <div class="card-header bg-neutral-50 border-bottom py-14 px-20 d-flex align-items-center justify-content-between flex-wrap gap-2">
                            <h6 class="text-sm fw-semibold text-primary-light mb-0 d-flex align-items-center gap-2">
                                <iconify-icon icon="mdi:cash-multiple" class="text-primary-600"></iconify-icon>
                                Additional charges (optional)
                            </h6>
                            <button type="button" id="return-add-charge" class="btn btn-sm btn-outline-primary radius-8 d-flex align-items-center gap-2">
                                <iconify-icon icon="mdi:plus"></iconify-icon> Add charge
                            </button>
                        </div>
                        <div class="card-body p-20">
                            <div id="return-charges-list"></div>
                            <p class="text-sm text-secondary-light mt-3 mb-0">Charges (e.g. late fee, fuel, damage) will be applied at return. Leave empty if none.</p>
                        </div>
                    </div>

                    <!-- Staff signature (person processing return) -->
                    <div class="card border radius-12 overflow-hidden mb-24">
                        <div class="card-header bg-neutral-50 border-bottom py-14 px-20">
                            <h6 class="text-sm fw-semibold text-primary-light mb-0 d-flex align-items-center gap-2">
                                <iconify-icon icon="mdi:draw" class="text-primary-600"></iconify-icon>
                                Staff signature (person processing return) <span class="text-secondary-light fw-normal">(optional)</span>
                            </h6>
                        </div>
                        <div class="card-body p-20">
                            <div class="border border-neutral-300 radius-12 bg-white overflow-hidden" style="max-width: 400px;">
                                <canvas id="return-staff-signature-canvas" width="400" height="120" style="display: block; width: 100%; height: auto; cursor: crosshair; touch-action: none;"></canvas>
                            </div>
                            <button type="button" id="return-signature-clear" class="btn btn-sm btn-outline-secondary radius-8 mt-2">
                                Clear signature
                            </button>
                        </div>
                    </div>

                    <div class="d-flex align-items-center justify-content-end gap-3">
                        <a href="#" id="return-process-cancel" class="btn border border-neutral-400 bg-hover-neutral-100 text-primary-light text-md px-24 py-12 radius-8 d-flex align-items-center gap-2">Cancel</a>
                        <button type="submit" class="btn btn-primary text-md px-32 py-12 radius-8 d-flex align-items-center gap-2">
                            <iconify-icon icon="mdi:check-circle-outline"></iconify-icon>
                            Complete return
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<% script = '<script src="/js/api/rentalApi.js"></script><script src="/js/pages/return-process.js"></script>' %>
