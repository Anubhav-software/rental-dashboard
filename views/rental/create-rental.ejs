<div class="card h-100 p-0 radius-12" data-base-path="<%= typeof basePath !== 'undefined' ? basePath : '' %>">
    <div class="card-body p-24">
        <div class="row justify-content-center">
            <div class="col-xxl-10 col-xl-11 col-lg-12">
                <div class="card border radius-12 overflow-hidden">
                    <div class="card-header bg-neutral-50 border-bottom py-16 px-24 d-flex align-items-center justify-content-between flex-wrap gap-2">
                        <h6 class="text-md text-primary-light mb-0 d-flex align-items-center gap-2">
                            <iconify-icon icon="mdi:file-document-edit-outline" class="text-primary-600"></iconify-icon>
                            Create Rental
                        </h6>
                        <a href="<%= typeof basePath !== 'undefined' ? basePath : '' %>/rental" class="btn btn-outline-secondary btn-sm radius-8 d-flex align-items-center gap-2">
                            <iconify-icon icon="mdi:arrow-left"></iconify-icon> Back
                        </a>
                    </div>
                    <div class="card-body p-24">
                        <% if (typeof error !== 'undefined' && error) { %>
                        <div class="alert alert-danger radius-12 mb-24 d-flex align-items-center gap-2">
                            <iconify-icon icon="mdi:alert-circle-outline"></iconify-icon>
                            <%= error %>
                        </div>
                        <% } %>
                        <form id="rental-form" class="rental-create-form">
                            <% const r = typeof rental !== 'undefined' && rental ? rental : {}; %>
                            <% const showMinimalRentalForm = (typeof useMinimalRentalForm !== 'undefined' ? useMinimalRentalForm : true); %>

                            <!-- Customer & Vehicle -->
                            <div class="card border radius-12 overflow-hidden mb-24">
                                <div class="card-header bg-neutral-50 border-bottom py-14 px-20">
                                    <h6 class="text-sm fw-semibold text-primary-light mb-0 d-flex align-items-center gap-2">
                                        <iconify-icon icon="mdi:account-car-outline" class="text-primary-600"></iconify-icon>
                                        Customer & Vehicle
                                    </h6>
                                </div>
                                <div class="card-body p-20">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label text-sm fw-medium text-primary-light">Customer <span class="text-danger">*</span></label>
                                            <select name="customerId" id="rental-customerId" class="form-select h-56-px bg-neutral-50 radius-12" required>
                                                <option value="">Loading customers…</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label text-sm fw-medium text-primary-light">Vehicle <span class="text-danger">*</span></label>
                                            <select name="vehicleId" id="rental-vehicleId" class="form-select h-56-px bg-neutral-50 radius-12" required>
                                                <option value="">Loading vehicles…</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Dates & Time -->
                            <div class="card border radius-12 overflow-hidden mb-24">
                                <div class="card-header bg-neutral-50 border-bottom py-14 px-20">
                                    <h6 class="text-sm fw-semibold text-primary-light mb-0 d-flex align-items-center gap-2">
                                        <iconify-icon icon="solar:calendar-outline" class="text-primary-600"></iconify-icon>
                                        Rental Period
                                    </h6>
                                </div>
                                <div class="card-body p-20">
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <label class="form-label text-sm fw-medium text-primary-light">Start date <span class="text-danger">*</span></label>
                                            <input type="date" name="startDate" id="startDate" class="form-control h-56-px bg-neutral-50 radius-12" value="<%= r.startDate || '' %>" required>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label text-sm fw-medium text-primary-light">Start time</label>
                                            <input type="time" name="startTime" id="startTime" class="form-control h-56-px bg-neutral-50 radius-12" value="<%= r.startTime || '10:00' %>">
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label text-sm fw-medium text-primary-light">End date <span class="text-danger">*</span></label>
                                            <input type="date" name="endDate" id="endDate" class="form-control h-56-px bg-neutral-50 radius-12" value="<%= r.endDate || '' %>" required>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label text-sm fw-medium text-primary-light">End time</label>
                                            <input type="time" name="endTime" id="endTime" class="form-control h-56-px bg-neutral-50 radius-12" value="<%= r.endTime || '10:00' %>">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Rate & Payment: total from vehicle's duration-based tiers (no charge method dropdown) -->
                            <input type="hidden" name="selectedChargeMethod" value="DAILY">
                            <div class="card border radius-12 overflow-hidden mb-24">
                                <div class="card-header bg-neutral-50 border-bottom py-14 px-20">
                                    <h6 class="text-sm fw-semibold text-primary-light mb-0 d-flex align-items-center gap-2">
                                        <iconify-icon icon="mdi:cash-multiple" class="text-primary-600"></iconify-icon>
                                        Rate & Payment
                                    </h6>
                                </div>
                                <div class="card-body p-20">
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label class="form-label text-sm fw-medium text-primary-light">Total amount (₹) <span class="text-danger">*</span></label>
                                            <input type="number" name="totalAmount" id="rental-totalAmount" class="form-control h-56-px bg-neutral-50 radius-12" placeholder="Auto from duration" min="0" step="0.01" value="<%= r.totalAmount != null ? r.totalAmount : '' %>" required title="Auto-calculated from rental period and vehicle's charges-by-duration (dailyRateTiers).">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label text-sm fw-medium text-primary-light">Advance paid (₹) <span class="text-danger">*</span></label>
                                            <input type="number" name="advancePaid" id="advancePaid" class="form-control h-56-px bg-neutral-50 radius-12" placeholder="0" min="0" step="0.01" value="<%= r.advancePaid != null ? r.advancePaid : '0' %>" required>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label text-sm fw-medium text-primary-light">Deposit (₹) <span class="text-danger">*</span></label>
                                            <input type="number" name="deposit" id="deposit" class="form-control h-56-px bg-neutral-50 radius-12" placeholder="0" min="0" step="0.01" value="<%= r.deposit != null ? r.deposit : '0' %>" required>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label text-sm fw-medium text-primary-light">Helmets</label>
                                            <input type="number" name="helmetsQuantity" id="helmetsQuantity" class="form-control h-56-px bg-neutral-50 radius-12" placeholder="0" min="0" value="<%= r.helmetsQuantity != null ? r.helmetsQuantity : '' %>">
                                        </div>
                                    </div>
                                    <div id="rental-calculation-breakdown" class="d-none mt-3 p-3 rounded-3 border border-start border-4 border-primary bg-light">
                                        <div class="d-flex align-items-center gap-2 mb-1">
                                            <iconify-icon icon="mdi:calculator-variant" class="text-primary fs-5"></iconify-icon>
                                            <span class="fw-semibold text-sm">Calculation</span>
                                        </div>
                                        <p id="rental-calculation-text" class="text-sm text-body mb-0 small"></p>
                                    </div>
                                    <p class="text-sm text-secondary-light mt-3 mb-0">Total is <strong>auto-calculated</strong> from the vehicle's <strong>charges by duration</strong> (e.g. 1 day, 5 days, 1 week) and the rental start/end — no charge method to choose. You can edit the amount if needed.</p>
                                </div>
                            </div>

                            <!-- Terms (required by API) -->
                            <div class="card border radius-12 overflow-hidden mb-24">
                                <div class="card-header bg-neutral-50 border-bottom py-14 px-20">
                                    <h6 class="text-sm fw-semibold text-primary-light mb-0 d-flex align-items-center gap-2">
                                        <iconify-icon icon="mdi:file-document-check-outline" class="text-primary-600"></iconify-icon>
                                        Terms
                                    </h6>
                                </div>
                                <div class="card-body p-20">
                                    <div class="form-check">
                                        <input type="checkbox" name="termsAccepted" id="termsAccepted" class="form-check-input" value="on" required>
                                        <label class="form-check-label text-sm text-primary-light" for="termsAccepted">Customer accepts the rental terms and conditions</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Signatures (optional) -->
                            <div class="card border radius-12 overflow-hidden mb-24">
                                <div class="card-header bg-neutral-50 border-bottom py-14 px-20">
                                    <h6 class="text-sm fw-semibold text-primary-light mb-0 d-flex align-items-center gap-2">
                                        <iconify-icon icon="mdi:draw" class="text-primary-600"></iconify-icon>
                                        Signatures <span class="text-secondary-light fw-normal">(optional)</span>
                                    </h6>
                                </div>
                                <div class="card-body p-20">
                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <label class="form-label text-sm fw-medium text-primary-light">Customer signature</label>
                                            <div class="border border-neutral-300 radius-12 bg-white overflow-hidden" style="max-width: 100%;">
                                                <canvas id="rental-customer-signature-canvas" width="400" height="120" style="display: block; width: 100%; max-width: 400px; height: auto; cursor: crosshair; touch-action: none;"></canvas>
                                            </div>
                                            <button type="button" id="rental-customer-signature-clear" class="btn btn-sm btn-outline-secondary radius-8 mt-2">Clear</button>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label text-sm fw-medium text-primary-light">Staff signature (person providing rental)</label>
                                            <div class="border border-neutral-300 radius-12 bg-white overflow-hidden" style="max-width: 100%;">
                                                <canvas id="rental-staff-signature-canvas" width="400" height="120" style="display: block; width: 100%; max-width: 400px; height: auto; cursor: crosshair; touch-action: none;"></canvas>
                                            </div>
                                            <button type="button" id="rental-staff-signature-clear" class="btn btn-sm btn-outline-secondary radius-8 mt-2">Clear</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <hr class="my-24">
                            <div class="d-flex align-items-center justify-content-end gap-3">
                                <a href="<%= typeof basePath !== 'undefined' ? basePath : '' %>/rental" class="btn border border-neutral-400 bg-hover-neutral-100 text-primary-light text-md px-24 py-12 radius-8 d-flex align-items-center gap-2">
                                    <iconify-icon icon="mdi:close"></iconify-icon>
                                    Cancel
                                </a>
                                <button type="submit" class="btn btn-primary text-md px-32 py-12 radius-8 d-flex align-items-center gap-2">
                                    <iconify-icon icon="mdi:content-save-outline"></iconify-icon>
                                    Create Rental
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<% script = '<script src="/js/api/rentalApi.js"></script><script src="/js/api/vehicleApi.js"></script><script src="/js/api/customerApi.js"></script><script src="/js/pages/rental-add.js"></script>' %>
